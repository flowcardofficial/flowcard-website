<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>FlowCard â€” Coming Soon</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#f6fbff;
  --text:#071133;
  --muted:#667085;
  --flow-1:#0B57D0;
  --flow-2:#00d4ff;
  --mono:'Poppins', system-ui, -apple-system, "Segoe UI", Roboto, Arial;
}

/* Global */
*{box-sizing:border-box;margin:0;padding:0;}
body{
  font-family:var(--mono);
  background:var(--bg);
  color:var(--text);
  display:flex;
  flex-direction:column;
  min-height:100vh;
  justify-content:flex-start;
  align-items:center;
  text-align:center;
  padding:20px;
}

/* Container */
.container{
  width: 100%;
  max-width: 1600px;
  display:flex;
  flex-direction:column;
  align-items:center;
  flex-grow:1;
  justify-content:center;
  padding-bottom:11px; 
}

/* Logo Pulse */
.logo img{
  height:80px;
  width:auto;
  margin-bottom:20px;
  animation: pulse 2s infinite;
}
@keyframes pulse{
  0% { transform: scale(1); }
  50% { transform: scale(1.08); }
  100% { transform: scale(1); }
}

/* Topbar */
.topbar{
  width:100%;
  display:flex;
  justify-content:flex-end;
  margin-bottom:20px;
}
.topbar button{
  padding:10px 20px;
  border:none;
  border-radius:50px;
  background:linear-gradient(90deg,var(--flow-1),var(--flow-2));
  color:white;
  font-weight:700;
  cursor:pointer;
  font-size:14px;
  box-shadow:0 10px 30px rgba(11,87,208,0.15);
}

/* Headline */
h1{font-size:36px; margin-bottom:16px; line-height:1.2;}
.gradient{background:linear-gradient(90deg,var(--flow-1),var(--flow-2)); -webkit-background-clip:text; color:transparent; display:inline-block;}
p{color:var(--muted); margin-bottom:32px; font-size:16px;}

/* Form */
form{
  display:flex;
  gap:25px;
  justify-content:center;
  margin-bottom:12px;
  flex-direction:column;
  align-items:center;
}
input[type="email"], input[type="text"]{
  width:330px;
  height:50px;
  padding:0 24px;
  border-radius:50px;
  border:1px solid rgba(0,0,0,0.1);
  font-size:16px;
  box-shadow: 0 10px 30px rgba(11,87,208,0.15);
}
button.submit-btn{
  width:150px;
  height:50px;
  border:none;
  border-radius:50px;
  background:linear-gradient(90deg,var(--flow-1),var(--flow-2));
  color:white;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  white-space:nowrap;
  box-shadow:0 10px 30px rgba(11,87,208,0.15);
  transition: all 0.3s ease;
}
button.submit-btn:hover{transform: scale(1.05);}

/* SOCIAL PROOF */
.social-proof{
  font-size:14px;
  color:var(--muted);
  margin-top:12px;
}

/* Confirmation Modal */
#confirmation{
  display:none;
  position:fixed;
  top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.4);
  backdrop-filter: blur(4px);
  justify-content:center;
  align-items:center;
  z-index:1000;
}
#confirmation .modal-content{
  background:white;
  padding:40px 30px 30px 30px;
  border-radius:30px;
  max-width:400px;
  width:90%;
  text-align:center;
  box-shadow:0 20px 50px rgba(11,87,208,0.2);
  transform:scale(0.8);
  opacity:0;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
  transition: all 0.3s ease;
}
#confirmation.show .modal-content{
  transform:scale(1);
  opacity:1;
}
#confirmation .modal-title{
  font-size:28px;
  font-weight:800;
  background:linear-gradient(90deg,#0B57D0,#00d4ff);
  -webkit-background-clip:text;
  color:transparent;
  margin-bottom:16px;
}
#confirmation .modal-text{
  color:#667085;
  font-size:16px;
  margin-bottom:16px;
  flex-grow:1;
}
#confirmation .modal-btn{
  padding:10px 20px;
  border-radius:50px;
  border:none;
  background:linear-gradient(90deg,#0B57D0,#00d4ff);
  color:white;
  font-weight:700;
  cursor:pointer;
  font-size:15px;
  align-self:center;
  margin-top:10px;
  box-shadow:0 10px 30px rgba(11,87,208,0.15);
}

/* MOBILE FIX */
@media(max-width: 500px){
  html, body{height:100vh; overflow:hidden;}
  form{flex-direction:column; gap:15px;}
}
</style>
</head>
<body>

<div class="topbar">
  <button id="profileBtn">My Profile</button>
</div>

<div class="container">
  <div class="logo">
    <img src="flowcard_logo_gradient.png" alt="FlowCard Logo">
  </div>
  <h1><span class="gradient">Launching in 2028</span></h1>
  <p>FlowCard is under construction. Sign up to be notified when we launch!</p>

  <form id="emailForm">
    <input type="email" name="email" placeholder="Enter your email" required>
    <input type="text" name="referredBy" placeholder="Referred by (optional)">
    <button type="submit" class="submit-btn">Notify Me</button>
  </form>

  <div class="social-proof"><span id="counter">0</span>+ teens have already signed up</div>
</div>

<!-- Confirmation Modal -->
<div id="confirmation">
  <div class="modal-content">
    <div class="modal-title">Thank you!</div>
    <div class="modal-text">
      Your email has been successfully registered. We'll notify you as soon as FlowCard launches!
    </div>
    <button class="modal-btn" onclick="closeModal()">Close</button>
  </div>
</div>

<div class="footer">&copy; 2025 FlowCard. All rights reserved.</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwCkYkBUJusW5lERl6_6o-rwJySQ1n5ifxTnhkag3t7GoBLfurlN-dWls73JNrOGLkc/exec"; // <-- replace with your deployed web app URL

// Counter animation (unchanged)
const counter = document.getElementById('counter');
let count = 0;
const target = 150;
const duration = 2000;
const stepTime = Math.abs(Math.floor(duration / target));
const counterInterval = setInterval(() => {
  count++;
  counter.textContent = count;
  if(count >= target) clearInterval(counterInterval);
}, stepTime);

// Form submission
const form = document.getElementById('emailForm');
const confirmation = document.getElementById('confirmation');

form.addEventListener('submit', function(e){
  e.preventDefault();
  const email = form.email.value.trim();
  const referredBy = form.referredBy.value.trim();

  // Scroll to top so user sees confirmation modal/feedback on mobile
  window.scrollTo({ top: 0, behavior: 'smooth' });

  // Fetch client IP (with fallback)
  fetch("https://api.ipify.org?format=json").then(res => res.json()).then(data => {
    const ip = data.ip || "unknown";

    // Call Apps Script (expect JSON back)
    fetch(SCRIPT_URL, {
      method: "POST",
      mode: "cors",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: `email=${encodeURIComponent(email)}&ip=${encodeURIComponent(ip)}&referredBy=${encodeURIComponent(referredBy)}`
    })
    .then(res => {
      // if server returns non-JSON due to deployment/permissions, handle gracefully
      return res.json().catch(() => {
        // fallback: if parsing fails, assume success but store a generated code
        return { success: true, referralCode: localStorage.getItem('flowReferralCode') || null };
      });
    })
    .then(data => {
      if (!data) {
        alert("Unexpected response from server. Try again.");
        return;
      }

      if (data.success) {
        // store the assigned referral code and email for profile page
        if (data.referralCode) {
          localStorage.setItem('flowReferralCode', data.referralCode);
        }
        localStorage.setItem('flowUserEmail', email);

        // show confirmation modal
        confirmation.style.display = 'flex';
        confirmation.classList.add('show');
        form.reset();
      } else {
        // Denied (duplicate email/ip or invalid ref). Show clear message.
        // If server returned a referralCode (existing owner), we store it so profile shows it.
        if (data.referralCode) localStorage.setItem('flowReferralCode', data.referralCode);
        alert(data.message || "Signup denied.");
      }
    })
    .catch(err => {
      console.error("Signup error:", err);
      alert("Network error while signing up. Please try again.");
    });

  }).catch(() => {
    // If IP fetch fails, proceed using "unknown" but still send the form
    const ip = "unknown";
    fetch(SCRIPT_URL, {
      method: "POST",
      mode: "cors",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: `email=${encodeURIComponent(email)}&ip=${encodeURIComponent(ip)}&referredBy=${encodeURIComponent(referredBy)}`
    })
    .then(res => res.json()).then(data => {
      if (data.success) {
        if (data.referralCode) localStorage.setItem('flowReferralCode', data.referralCode);
        localStorage.setItem('flowUserEmail', email);
        confirmation.style.display = 'flex';
        confirmation.classList.add('show');
        form.reset();
      } else {
        if (data.referralCode) localStorage.setItem('flowReferralCode', data.referralCode);
        alert(data.message || "Signup denied.");
      }
    })
    .catch(err => {
      console.error("Signup error fallback:", err);
      alert("Network error while signing up. Please try again.");
    });
  });
});

function closeModal(){
  confirmation.classList.remove('show');
  setTimeout(() => { confirmation.style.display='none'; }, 300);
}

// Profile button click (same domain)
document.getElementById('profileBtn').addEventListener('click', () => {
  window.location.href = "profile.html";
});
</script>

</body>
</html>
